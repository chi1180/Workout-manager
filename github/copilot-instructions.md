# Copilot Instructions for Workout Manager

## このドキュメントについて

- GitHub Copilot や各種 AI ツールが本リポジトリのコンテキストを理解しやすくするためのガイドです。
- 新しい機能を実装する際はここで示す技術選定・設計方針・モジュール構成を前提にしてください。
- 不確かな点がある場合は、リポジトリのファイルを探索し、ユーザーに「こういうことですか?」と確認をするようにしてください。

## 前提条件

- 回答は必ず日本語でしてください。
- 何か大きい変更を加える場合（既存のコード200行以上書き換える場合。新規に200行以上のコードを追加する場合は問題なし。）、まず何をするのか計画を立てた上で、ユーザーに「このような計画で進めようと思います。」と提案してください。この時、ユーザーから計画の修正を求められた場合は計画を修正して、再提案をしてください。

## アプリ概要

健康な精神は健康な肉体から！をモットーに、運動習慣の継続をサポートするインタラクティブなワークアウト管理アプリです。Duolingoのような楽しく続けられるUIで、ユーザーの目標に合わせたトレーニングプランを提供します。

### 主な機能

- **オンボーディング**: 初回訪問時にユーザーの運動レベル、目標、制約をヒアリング
- **パーソナライズドプラン**: ユーザー情報に基づいた週間トレーニングプログラムの生成
- **デイリーダッシュボード**: その日のアクティビティをタスク形式で表示・チェック
- **アクティビティ履歴**: GitHubスタイルのヒートマップで運動履歴を可視化
- **ストリーク管理**: 連続実施日数を追跡してモチベーション向上
- **統計・分析**: 総トレーニング日数、最長ストリーク、月間達成率など

## 技術スタック概要

- **フレームワーク**: React 18+ (関数コンポーネント + Hooks)
- **スタイリング**: Tailwind CSS
- **アイコン**: lucide-react
- **ルーティング**: ハッシュベースルーティング (`/#/path`)
- **状態管理**: React Hooks (useState, useReducer, useContext)
- **データ永続化**:
  - localStorage (ユーザープロファイル、設定)
  - IndexedDB (アクティビティ履歴、統計データ)
- **ビルド**: 単一HTMLファイル出力（GitHub Pages対応）
- **AI統合**: ChatGPT API（トレーニングプラン生成用、将来実装予定）

## プロジェクト構成と役割

本アプリは機能ベースのディレクトリ構成を採用し、関心の分離とスケーラビリティを実現しています。

```
workout-manager/
├── index.html                 # エントリーポイント（React + Tailwind CDN）
├── src/
│   ├── App.jsx               # ルートコンポーネント、ルーティング管理
│   ├── hooks/                # カスタムフック
│   │   ├── useLocalStorage.js      # localStorage操作
│   │   ├── useIndexedDB.js         # IndexedDB操作
│   │   ├── useActivityTracker.js   # アクティビティの追跡・管理
│   │   └── useStreak.js            # ストリーク計算
│   ├── components/           # 共通UIコンポーネント
│   │   ├── Layout/
│   │   │   ├── Header.jsx          # ヘッダー（ナビゲーション）
│   │   │   └── Footer.jsx          # フッター
│   │   ├── UI/
│   │   │   ├── Button.jsx          # 汎用ボタン
│   │   │   ├── Card.jsx            # カードコンポーネント
│   │   │   ├── ProgressBar.jsx     # 進捗バー
│   │   │   ├── Checkbox.jsx        # チェックボックス
│   │   │   └── Modal.jsx           # モーダルダイアログ
│   │   └── Animations/
│   │       └── Celebration.jsx     # 完了時のお祝いアニメーション
│   ├── pages/                # ページコンポーネント
│   │   ├── Onboarding/
│   │   │   ├── index.jsx           # オンボーディングフロー
│   │   │   ├── QuestionSlide.jsx   # 質問スライド
│   │   │   └── ProgressIndicator.jsx # 進捗インジケーター
│   │   ├── Dashboard/
│   │   │   ├── index.jsx           # ダッシュボードメイン
│   │   │   ├── TodayActivity.jsx   # 今日のアクティビティカード
│   │   │   ├── ExerciseCard.jsx    # 個別エクササイズカード
│   │   │   └── WeeklyProgress.jsx  # 週間進捗表示
│   │   ├── History/
│   │   │   ├── index.jsx           # 履歴ページメイン
│   │   │   ├── HeatMap.jsx         # GitHubスタイルヒートマップ
│   │   │   └── Statistics.jsx      # 統計情報
│   │   └── Settings/
│   │       ├── index.jsx           # 設定ページメイン
│   │       ├── ProfileSettings.jsx # プロファイル再設定
│   │       └── DataManagement.jsx  # データ管理（エクスポート/リセット）
│   ├── utils/                # ユーティリティ関数
│   │   ├── storage.js              # localStorage/IndexedDBヘルパー
│   │   ├── dateUtils.js            # 日付関連ユーティリティ
│   │   ├── trainingPlanGenerator.js # ダミートレーニングプラン生成
│   │   └── validators.js           # バリデーション関数
│   ├── constants/            # 定数定義
│   │   ├── questions.js            # オンボーディング質問データ
│   │   ├── exercises.js            # エクササイズマスターデータ
│   │   └── routes.js               # ルート定義
│   └── types/                # TypeScript型定義（将来的に）
│       └── index.d.ts
├── .github/
│   └── copilot-instructions.md    # 本ファイル
└── README.md                 # プロジェクト説明
```

### 各ディレクトリの役割詳細

#### `hooks/`

- アプリケーション固有のロジックをカプセル化
- データ永続化、状態管理、副作用の処理を担当
- コンポーネントから複雑なロジックを分離し、再利用性を向上

#### `components/`

- **Layout**: ページ共通のレイアウトコンポーネント
- **UI**: 再利用可能なプレゼンテーショナルコンポーネント
- **Animations**: アニメーション関連コンポーネント

#### `pages/`

- 各ルートに対応するページコンポーネント
- ページ固有のロジックとUIを含む
- サブコンポーネントは各ページディレクトリ内に配置

#### `utils/`

- 純粋関数のユーティリティ
- 副作用のないヘルパー関数
- テスト容易性を重視

#### `constants/`

- マジックナンバー・文字列を排除
- 設定値やマスターデータを一元管理

## コーディング規約・ベストプラクティス

### コード編集後に毎回すべきこと

このファイル（.github/copilot-instructions.md）の、「プロジェクト構成と役割」の部分について、アップデートが必要な点があればアップデートしてください。
アップデートした内容に関しては、ユーザに伝えといてください。

### React コンポーネント設計

- **関数コンポーネント**: クラスコンポーネントは使用しない
- **Hooks優先**: ライフサイクルメソッドではなくHooksを使用
- **単一責任の原則**: 1コンポーネント1責務
- **Props型定義**: PropTypesまたはJSDocで型を明示
- **デフォルトProps**: 必要に応じてdefaultPropsを定義

### 命名規則

- **コンポーネント**: PascalCase (例: `ExerciseCard.jsx`)
- **フック**: camelCaseで`use`プレフィックス (例: `useActivityTracker`)
- **ユーティリティ関数**: camelCase (例: `formatDate`)
- **定数**: UPPER_SNAKE_CASE (例: `MAX_EXERCISES_PER_DAY`)
- **ファイル名**: コンポーネントはPascalCase、その他はcamelCase

### データ永続化

- **localStorage**:
  - ユーザープロファイル
  - アプリ設定
  - 軽量なデータ（5MB未満）
- **IndexedDB**:
  - アクティビティ履歴
  - 統計データ
  - 大量のデータや構造化データ

### パフォーマンス最適化

- **遅延ロード**: 必要に応じてReact.lazyを使用
- **メモ化**: 高コストな計算はuseMemoで、コールバックはuseCallbackで
- **仮想スクロール**: 長いリストには仮想化を検討
- **画像最適化**: 適切なサイズとフォーマット

### アクセシビリティ

- **セマンティックHTML**: 適切なHTML要素を使用
- **ARIAラベル**: 必要に応じてaria-\*属性を追加
- **キーボード操作**: すべての機能をキーボードで操作可能に
- **カラーコントラスト**: WCAG AA基準を満たす

### コメント

- **JSDoc**: 複雑な関数には JSDoc コメントを付与
- **TODO コメント**: タスクについてはその箇所に `// TODO ::: [ ] here is to do content` を残す
- **コードの意図**: 「何を」ではなく「なぜ」を説明

### テスト（将来実装予定）

- **単体テスト**: ユーティリティ関数とフックをテスト
- **コンポーネントテスト**: React Testing Libraryを使用
- **統合テスト**: 重要なユーザーフローをカバー

## アンチパターン

以下のパターンは避けてください。既存コードで発見した場合は、リファクタリングを提案してください。

### コンポーネント設計

- **巨大コンポーネント**: 1つのコンポーネントが200行を超える場合は分割を検討
- **Prop Drilling**: 深い階層での props バケツリレーは、Context や状態管理ライブラリで解決
- **useEffect の濫用**: データフェッチは専用フックで、イベントハンドラーで済む処理は useEffect を使わない
- **インラインスタイル**: Tailwindのユーティリティクラスを優先
- **複雑なネスト**: 3階層を超えるJSXネストは避ける

### 状態管理

- **過度なグローバル状態**: 真にグローバルな状態のみをContextで管理
- **useState の濫用**: 複雑な状態は useReducer で管理
- **直接的な状態変更**: イミュータブルな更新を心がける
- **派生状態**: 計算可能な値は状態にせず、useMemoで導出

### パフォーマンス

- **不要な再レンダリング**: React DevTools Profiler で計測し、必要に応じて最適化
- **過度な最適化**: 実測せずに useMemo/useCallback を多用しない
- **巨大なバンドル**: Code Splitting を活用し、初期ロードを軽量化
- **同期的なlocalStorage操作**: 大量データの読み書きは非同期的に

### データ管理

- **直接的なlocalStorage操作**: 専用フックを経由してアクセス
- **IndexedDBの直接操作**: ラッパー関数を使用
- **エラーハンドリングの欠如**: すべてのデータ操作にtry-catchを

### セキュリティ

- **XSS脆弱性**: ユーザー入力は適切にサニタイズ
- **機密情報の保存**: localStorage/IndexedDBに機密データを保存しない
- **APIキーの露出**: クライアントサイドにAPIキーを直接埋め込まない

## 将来の拡張予定

- **Gemini API統合**: パーソナライズされたトレーニングプラン生成
- **プログレッシブWebApp (PWA)**: オフライン対応、プッシュ通知
- **ソーシャル機能**: 友達とのストリーク比較、共有機能
- **多言語対応**: i18n導入
- **ダークモード**: テーマ切り替え機能
- **音声ガイド**: エクササイズの音声指示
- **ウェアラブル連携**: スマートウォッチとの統合
